import{q as S,r as o,j as e,b as F,a as G}from"./app-DfPUS0g-.js";import{A as _}from"./AuthenticatedLayout-DP1sGqdd.js";import{S as L}from"./sweetalert2.esm.all-ePrzfkxH.js";import{F as $}from"./file-spreadsheet-DUzECmJK.js";import{L as q}from"./layout-dashboard-CJdz84ez.js";import{S as p}from"./search-B22_l6qK.js";import{U as C}from"./user-D7jZvcVM.js";import{S as z}from"./save-BXAp3K--.js";import{F as B}from"./file-pen-line-BF_fp1GF.js";import{T as I}from"./trash-2-DECHFhCc.js";import{F as M}from"./funnel-RwBh1FFU.js";import{C as O}from"./clock-CAzn1UTl.js";import"./transition-CdeAVsF6.js";import"./render-TPd2KTBo.js";import"./createLucideIcon-BW7jgRi7.js";const ie=Q=>{var w;const{logs:D,lobbies:i}=S().props,{auth:A}=S().props,[h,T]=o.useState(""),[n,k]=o.useState("all"),[a,u]=o.useState(null),[g,R]=o.useState(""),[f,E]=o.useState([]),[j,y]=o.useState(!1);o.useEffect(()=>{i&&i.length>0&&(E(i),!a&&i[0]&&u(i[0].id))},[i]);const N=f.filter(t=>t.name.toLowerCase().includes(g.toLowerCase())),v=D,P=t=>t?new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"Active Session",l=v.filter(t=>{var r,d,c,x;if(a&&t.lobby_id!==a)return!1;const s=((d=(r=t.lobby)==null?void 0:r.name)==null?void 0:d.toString().includes(h))||((x=(c=t.lobby)==null?void 0:c.lobby_code)==null?void 0:x.includes(h));return n==="all"?s:n==="created"?s&&t.action==0:n==="edited"?s&&t.action==1:n==="deleted"?s&&t.action==2:s}),U=async()=>{var t;y(!0);try{const s=a?`/${a}`:"",r=await G.get(`/report/lobby-management${s}`,{responseType:"blob"});if(r.status===200){let d="lobby_management_logs.xlsx";const c=r.headers["content-disposition"];if(c){const b=c.match(/filename="?([^"]+)"?/);b&&b[1]&&(d=b[1])}const x=window.URL.createObjectURL(new Blob([r.data])),m=document.createElement("a");m.href=x,m.setAttribute("download",d),document.body.appendChild(m),m.click(),m.remove(),window.URL.revokeObjectURL(x),L.fire({toast:!0,position:"top-end",icon:"success",title:"Report downloaded successfully!",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}}catch(s){console.error("Error during report download:",s);let r="An error occurred during download.";s.response?r=((t=s.response.data)==null?void 0:t.message)||`Server error: ${s.response.status}`:s.request?r="No response from server. Please check your connection.":r=s.message||"An unexpected error occurred.",L.fire({toast:!0,position:"top-end",icon:"error",title:r,showConfirmButton:!1,timer:4e3,timerProgressBar:!0})}finally{y(!1)}};return e.jsx(_,{children:e.jsx("div",{className:"min-h-screen bg-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2 bg-gradient-to-r from-red-600 to-amber-600 bg-clip-text text-transparent",children:"Lobby Logs"}),e.jsx("p",{className:"text-gray-600",children:"Monitor and track lobby activity"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),U()},disabled:j,className:"bg-orange-600 text-white p-4 flex gap-x-3 rounded-md hover:bg-orange-700 hover:cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed transition-colors",type:"button",children:[e.jsx($,{className:"w-5 h-5"}),e.jsx("p",{children:j?"Generating...":"Generate Report"})]}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),F.get("/organizerLobby")},className:"bg-red-500 text-white p-4 flex gap-x-3 rounded-md hover:bg-red-700 hover:cursor-pointer",type:"button",children:[e.jsx(q,{}),e.jsx("p",{children:"Go to Dashboard"})]})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-80 flex-shrink-0",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-2",children:"Quiz Event"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select a quiz event to filter logs"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search quiz event...",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",value:g,onChange:t=>R(t.target.value)}),e.jsx(p,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:N.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No quiz events found"}):N.map(t=>e.jsx("button",{onClick:()=>u(t.id),className:`w-full text-left px-4 py-3 rounded-lg transition-colors ${a===t.id?"bg-orange-500 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-900"}`,children:t.name},t.id))})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-red-500 p-6 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Lobby"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.length})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:e.jsx(C,{className:"w-6 h-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-green-500 p-6 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Created"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.filter(t=>t.action==0).length})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(z,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-red-500 p-6 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Edited"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.filter(t=>t.action==1).length})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full",children:e.jsx(B,{className:"w-6 h-6 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-red-500 p-6 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Deleted"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.filter(t=>t.action==2).length})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:e.jsx(I,{className:"w-6 h-6 text-red-600"})})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(p,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by ID or IP address...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors",value:h,onChange:t=>T(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-200 rounded-lg px-7 py-3  focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white",value:n,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"edited",children:"Edited"}),e.jsx("option",{value:"deleted",children:"Deleted"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage Lobby"}),a&&e.jsxs("span",{className:"text-sm text-gray-600",children:["- ",((w=f.find(t=>t.id===a))==null?void 0:w.name)||""]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-red-500 to-amber-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"User ID"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Lobby Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Lobby Code"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Action"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Date Time"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:l.map((t,s)=>e.jsxs("tr",{className:`hover:bg-red-50 transition-colors duration-200 ${s%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 font-medium",children:A.user.name})]})}),e.jsx("td",{className:"px-6 py-4",children:t.lobby.name}),e.jsx("td",{className:"px-6 py-4",children:t.lobby.lobby_code}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-sm font-medium ${t.action==0?"bg-blue-100 text-blue-800":t.action==1?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.action==0?"Create":t.action==1?"Edit":"Delete"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 text-sm",children:P(t.created_at)})]})})]},t.id))})]})}),l.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(p,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No data found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search criteria or filters."})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-gray-500 text-sm",children:["Showing ",l.length," of ",a?l.length:v.length," sessions"]})})]})]})]})})})};export{ie as default};
