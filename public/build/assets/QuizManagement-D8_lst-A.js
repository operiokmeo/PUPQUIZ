import{q as C,r as x,j as e,b as U,a as _}from"./app-DfPUS0g-.js";import{A as $}from"./AuthenticatedLayout-DP1sGqdd.js";import{S as L}from"./sweetalert2.esm.all-ePrzfkxH.js";import{F}from"./file-spreadsheet-DUzECmJK.js";import{L as P}from"./layout-dashboard-CJdz84ez.js";import{C as G,a as B}from"./chevron-right-p5ycHldi.js";import{S as g}from"./search-B22_l6qK.js";import{U as D}from"./user-D7jZvcVM.js";import{S as M}from"./save-BXAp3K--.js";import{F as O}from"./file-pen-line-BF_fp1GF.js";import{T as H}from"./trash-2-DECHFhCc.js";import{F as J}from"./funnel-RwBh1FFU.js";import{C as K}from"./clock-CAzn1UTl.js";import"./transition-CdeAVsF6.js";import"./render-TPd2KTBo.js";import"./createLucideIcon-BW7jgRi7.js";const ge=V=>{var q;const{logs:T,lobbies:h}=C().props,{auth:Q}=C().props,[u,z]=x.useState(""),[m,k]=x.useState("all"),[i,p]=x.useState("all"),[f,E]=x.useState(""),[b,A]=x.useState([]),[j,y]=x.useState(!1),[N,v]=x.useState(!1);x.useEffect(()=>{h&&h.length>0&&A(h)},[h]);const w=b.filter(t=>t.name.toLowerCase().includes(f.toLowerCase())),S=T,R=t=>t?new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"Active Session",o=S.filter(t=>{var r,l,d,n,a,c;if(i!=="all"&&i&&((l=(r=t.question)==null?void 0:r.subject)==null?void 0:l.lobby_id)!==i)return!1;const s=((n=(d=t.question)==null?void 0:d.question)==null?void 0:n.toString().includes(u))||((c=(a=t.question)==null?void 0:a.difficulty)==null?void 0:c.includes(u));return m==="all"?s:m==="created"?s&&t.action==0:m==="edited"?s&&t.action==1:m==="deleted"?s&&t.action==2:s}).reduce((t,s)=>{var d;const r=(d=s.question)==null?void 0:d.id;if(!r)return t;const l=t.findIndex(n=>{var a;return((a=n.question)==null?void 0:a.id)===r});if(l===-1)t.push(s);else{const n=t[l],a=new Date(s.created_at).getTime(),c=new Date(n.created_at).getTime();(s.action===2||n.action!==2&&a>c)&&(t[l]=s)}return t},[]).sort((t,s)=>new Date(s.created_at).getTime()-new Date(t.created_at).getTime()),I=async()=>{var t;v(!0);try{const s=i!=="all"&&i?`/${i}`:"",r=await _.get(`/report/quiz-management${s}`,{responseType:"blob"});if(r.status===200){let l="quiz_management_logs.xlsx";const d=r.headers["content-disposition"];if(d){const c=d.match(/filename="?([^"]+)"?/);c&&c[1]&&(l=c[1])}const n=window.URL.createObjectURL(new Blob([r.data])),a=document.createElement("a");a.href=n,a.setAttribute("download",l),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(n),L.fire({toast:!0,position:"top-end",icon:"success",title:"Report downloaded successfully!",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}}catch(s){console.error("Error during report download:",s);let r="An error occurred during download.";s.response?r=((t=s.response.data)==null?void 0:t.message)||`Server error: ${s.response.status}`:s.request?r="No response from server. Please check your connection.":r=s.message||"An unexpected error occurred.",L.fire({toast:!0,position:"top-end",icon:"error",title:r,showConfirmButton:!1,timer:4e3,timerProgressBar:!0})}finally{v(!1)}};return e.jsx($,{children:e.jsx("div",{className:"min-h-screen bg-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2 bg-gradient-to-r from-red-600 to-amber-600 bg-clip-text text-transparent",children:"Event Quiz Logs"}),e.jsx("p",{className:"text-gray-600",children:"Monitor and track quiz activity"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),I()},disabled:N,className:"bg-orange-600 text-white p-4 flex gap-x-3 rounded-md hover:bg-orange-700 hover:cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed transition-colors",type:"button",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("p",{children:N?"Generating...":"Generate Report"})]}),e.jsxs("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),U.get("/organizerLobby")},className:"bg-red-500 text-white p-4 flex gap-x-3 rounded-md hover:bg-red-700 hover:cursor-pointer",type:"button",children:[e.jsx(P,{}),e.jsx("p",{children:"Go to Dashboard"})]})]})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:`${j?"w-0":"w-80"} flex-shrink-0 transition-all duration-300 overflow-hidden`,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 mb-2",children:"Event Quiz Sessions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a live event quiz session to filter quiz logs"})]}),e.jsx("button",{onClick:()=>y(!0),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",type:"button",title:"Collapse sidebar",children:e.jsx(G,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search live session...",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",value:f,onChange:t=>E(t.target.value)}),e.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"})]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[e.jsx("button",{onClick:()=>p("all"),className:`w-full text-left px-4 py-3 rounded-lg transition-colors ${i==="all"?"bg-orange-500 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-900"}`,type:"button",children:"All Event Quiz Sessions"}),w.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No live sessions found"}):w.map(t=>e.jsx("button",{onClick:()=>p(t.id),className:`w-full text-left px-4 py-3 rounded-lg transition-colors ${i===t.id?"bg-orange-500 text-white":"bg-gray-50 hover:bg-gray-100 text-gray-900"}`,type:"button",children:t.name},t.id))]})]})}),j&&e.jsx("button",{onClick:()=>y(!1),className:"self-start p-2 bg-white rounded-lg shadow-lg hover:bg-gray-50 transition-colors",type:"button",title:"Expand sidebar",children:e.jsx(B,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-red-500 p-6 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Questions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.length})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:e.jsx(D,{className:"w-6 h-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-green-500 p-6 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Created Questions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.filter(t=>t.action==0).length})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(M,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-red-500 p-6 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Edited Questions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.filter(t=>t.action==1).length})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full",children:e.jsx(O,{className:"w-6 h-6 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-red-500 p-6 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Deleted Questions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.filter(t=>t.action==2).length})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:e.jsx(H,{className:"w-6 h-6 text-red-600"})})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search quiz questions...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors",value:u,onChange:t=>z(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-200 rounded-lg px-7 py-3  focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white",value:m,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"edited",children:"Edited"}),e.jsx("option",{value:"deleted",children:"Deleted"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Manage Quiz Questions"}),i!=="all"&&i&&e.jsxs("span",{className:"text-sm text-gray-600",children:["- Live Event Quiz Session: ",((q=b.find(t=>t.id===i))==null?void 0:q.name)||""]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-orange-500 to-amber-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"User ID"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Question Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Question Type"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Question Level"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Action"}),e.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-white",children:"Date Time"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:o.map((t,s)=>e.jsxs("tr",{className:`hover:bg-red-50 transition-colors duration-200 ${s%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 font-medium",children:Q.user.name})]})}),e.jsx("td",{className:"px-6 py-4 capitalize",children:t.question.question}),e.jsx("td",{className:"px-6 py-4 capitalize",children:t.question.type}),e.jsx("td",{className:"px-6 py-4 capitalize",children:t.question.difficulty}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-sm font-medium ${t.action==0?"bg-blue-100 text-blue-800":t.action==1?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.action==0?"Create":t.action==1?"Edit":"Delete"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-900 text-sm",children:R(t.created_at)})]})})]},t.id))})]})}),o.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(g,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No data found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search criteria or filters."})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("p",{className:"text-gray-500 text-sm",children:["Showing ",o.length," of ",i?o.length:S.length," questions"]})})]})]})]})})})};export{ge as default};
