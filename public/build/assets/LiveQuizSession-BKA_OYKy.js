import{q as K,r as d,j as e,B as N,b as Q}from"./app-DWT7hB3X.js";import{A as v}from"./AuthenticatedLayout-oP7-p8OQ.js";import{S as T}from"./sweetalert2.esm.all-ePrzfkxH.js";import{C as G,A as J}from"./AnimatedTimer-BolagOBO.js";import{L as V}from"./soundEffects-DP_uyALH.js";import{C as Z}from"./circle-play-CHd-vt5Y.js";import{C as F}from"./circle-check-big-B58ItzMs.js";import{c as z}from"./createLucideIcon-Dpa32nA7.js";import{A as ee}from"./award-Dbk2pfzc.js";import{U as te}from"./user-CL-HRr1h.js";import{D as se}from"./download-DDU8GDQf.js";import"./transition-D2D_kb1X.js";import"./render-DRiD-TBL.js";import"./clock-DY8zjvnn.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["polygon",{points:"13 19 22 12 13 5 13 19",key:"587y9g"}],["polygon",{points:"2 19 11 12 2 5 2 19",key:"3pweh0"}]],ne=z("fast-forward",re);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],ie=z("printer",ae);function je({quiz:i}){var q;const{auth:D}=K().props,f=(q=D.user)==null?void 0:q.id,[s,L]=d.useState(null),[C,A]=d.useState([]),[I,$]=d.useState(!0),[R,_]=d.useState(null),[p,S]=d.useState(null),y=i.id;d.useEffect(()=>{const t=async()=>{var c,a,h,k;if(!f){_("Please log in to view the live quiz session."),$(!1);return}try{const l=((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.getAttribute("content"))||"",o=await fetch(`/api/live-quizzes/${y}/session`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(o.ok){const u=await o.json();L(u)}else if(o.status===404&&f){const u={quiz_id:i.id,current_question_index:0,show_answer:!1,status:"waiting",session_host_id:f},g=await fetch(`/api/live-quizzes/${y}/create-session`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify(u)});if(g.ok){const b=await g.json();L(b)}else{const b=await g.json().catch(()=>({}));throw new Error(b.message||`Failed to create session: ${g.statusText}`)}}else{if(o.status===401||o.status===403)throw new Error("You are not authorized to view this session.");{const u=await o.json().catch(()=>({}));throw new Error(u.message||`Failed to fetch session: ${o.statusText}`)}}const j=await fetch(`/api/live-quizzes/${y}/participants`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!j.ok)j.status===404?A([]):(console.warn("Failed to fetch participants:",j.statusText),A([]));else{const u=await j.json();u.sort((g,b)=>{if(b.score!==g.score)return b.score-g.score;const B=g.last_answer_time?new Date(g.last_answer_time).getTime():0,M=b.last_answer_time?new Date(b.last_answer_time).getTime():0;return B-M}),A(Array.isArray(u)?u:[])}}catch(l){console.error("Error fetching live session data or participants:",l),(a=l.message)!=null&&a.includes("Failed to fetch")||(h=l.message)!=null&&h.includes("ERR_CONNECTION_REFUSED")||(k=l.message)!=null&&k.includes("NetworkError")?_("Unable to connect to the server. Please check your internet connection and try again."):l.message?_(`Failed to load data: ${l.message}`):_("Failed to load data. Please try again.")}finally{$(!1)}};t();const n=setInterval(t,2e3);return()=>clearInterval(n)},[y,i.id,f]);const r=d.useMemo(()=>s&&s.current_question_index<i.questions.length?i.questions[s.current_question_index]:null,[s,i.questions]),m=f&&(s==null?void 0:s.session_host_id)===f,w=d.useCallback(async(t,n="POST",c)=>{if(!f||!m){T.fire({icon:"error",title:"Authorization Error",text:"You are not authorized to perform this action (Not host or not logged in)."});return}try{const a=await fetch(`/api/live-quizzes/${y}/${t}`,{method:n,headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(c)});if(!a.ok){const h=await a.json();throw new Error(h.message||a.statusText)}}catch(a){console.error(`Error in ${t}:`,a),T.fire({icon:"error",title:"Action Failed",text:`Error performing action: ${a.message}`})}},[f,m,y]),E=d.useCallback(async()=>{if(!s)return;const t=s.current_question_index+1;t<i.questions.length?await w("next-question","POST",{next_question_index:t}):(await w("end-quiz"),T.fire({icon:"info",title:"Quiz Finished!",text:"The quiz has ended. You can now check the overall results."}))},[s,i.questions.length,w]),O=d.useCallback(async()=>{!s||s.status==="active"||await w("start-quiz")},[s,w]),P=d.useCallback(async()=>{!s||s.show_answer||await w("reveal-answer")},[s,w]);d.useEffect(()=>{let t=null;return s&&s.status==="active"&&r&&r.time_limit!==void 0?((p===null||p===0||s.current_question_index!==i.questions.indexOf(r))&&S(r.time_limit),m&&p!==null&&p>0&&!s.show_answer?t=setInterval(()=>{S(n=>n===null||n<=1?(clearInterval(t),E(),0):n-1)},1e3):!m&&p!==null&&p>0&&!s.show_answer&&(t=setInterval(()=>{S(n=>n===null||n<=1?(clearInterval(t),0):n-1)},1e3))):S(null),()=>{t&&clearInterval(t)}},[s,r,m,p,E]);const X=t=>{var n;switch(t.type){case"multiple-choice":const c=(n=t.options)==null?void 0:n.find(a=>a.is_correct);return c?c.option_text:"N/A";case"true-false":return t.true_false_answer!==null?t.true_false_answer?"True":"False":"N/A";case"short-answer":return t.short_answer||"N/A";default:return"N/A"}},H=t=>!r||!t.answers?null:t.answers[r.id],U=()=>{window.print()},W=()=>{let t="data:text/csv;charset=utf-8,";t+="Rank,Participant Name,Score",i.questions.forEach((a,h)=>{t+=`,"Q${h+1}: ${a.question_text.replace(/"/g,'""')}"`,t+=`,"Q${h+1} Answer Status"`}),t+=`
`,C.forEach((a,h)=>{let k=`${h+1},"${a.user_name.replace(/"/g,'""')}",${a.score}`;i.questions.forEach(l=>{const o=a.answers?a.answers[l.id]:null,j=o?typeof o.submitted=="boolean"?o.submitted?"True":"False":String(o.submitted).replace(/"/g,'""'):"N/A",u=o?o.is_correct?"Correct":"Incorrect":"No Answer";k+=`,"${j}","${u}"`}),t+=k+`
`});const n=encodeURI(t),c=document.createElement("a");c.setAttribute("href",n),c.setAttribute("download",`leaderboard_${i.title.replace(/\s+/g,"_")}_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(c),c.click(),document.body.removeChild(c)};if(I)return e.jsxs(v,{children:[e.jsx(N,{title:"Live Quiz Session"}),e.jsx("div",{className:"py-12 text-center",children:e.jsxs("p",{className:"text-gray-600 flex items-center justify-center",children:[e.jsx(V,{className:"animate-spin mr-2",size:24})," Loading live session..."]})})]});if(R)return e.jsxs(v,{children:[e.jsx(N,{title:"Live Quiz Session"}),e.jsx("div",{className:"py-12 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(G,{className:"inline-block mr-2 text-red-600 mb-4",size:48}),e.jsx("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Failed to Load Live Quiz Session"}),e.jsx("p",{className:"text-red-600 mb-4",children:R}),e.jsx("button",{onClick:()=>{_(null),$(!0),window.location.reload()},className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-6 rounded-lg transition-colors",children:"Retry"})]})})]});if(!s||!r){const t=(s==null?void 0:s.status)==="finished";return(s==null?void 0:s.status)==="waiting"?e.jsxs(v,{children:[e.jsx(N,{title:"Live Quiz Session"}),e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Waiting for the host to start the quiz."}),e.jsxs("p",{className:"text-gray-600",children:["Quiz Code: ",e.jsx("span",{className:"font-bold text-indigo-700",children:i.code})]})]})]}):t?e.jsxs(v,{children:[e.jsx(N,{title:"Live Quiz Session"}),e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("h3",{className:"text-3xl font-bold text-green-700 mb-4",children:"Quiz Finished!"}),e.jsx("p",{className:"text-lg text-gray-700 mb-6",children:"You can now check the final leaderboard."}),e.jsx("button",{onClick:()=>Q.visit(route("dashboard")),className:"inline-flex items-center px-6 py-3 bg-gray-600 border border-transparent rounded-md font-semibold text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition ease-in-out duration-150",children:"Back to Dashboard"})]})]}):e.jsxs(v,{children:[e.jsx(N,{title:"Live Quiz Session"}),e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No active question or quiz data available for this session."})})]})}const Y=s.status==="finished";s.status;const x=s.show_answer;return e.jsxs(v,{header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:["Live Session: ",i.title]}),children:[e.jsx(N,{title:`Live Session: ${i.title}`}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:[e.jsxs("h3",{className:"text-2xl font-bold mb-4",children:["Current Question (",s.current_question_index+1," / ",i.questions.length,")"]}),!m&&e.jsx("p",{className:"text-red-500 text-sm mb-4",children:"You are in spectator mode. You are not the host."}),s.status==="waiting"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("p",{className:"text-lg text-gray-700 mb-4",children:["The quiz code is: ",e.jsx("span",{className:"font-bold text-indigo-700 text-3xl",children:i.code})]}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Share this with your participants to join."}),m&&e.jsxs("button",{onClick:O,className:"inline-flex items-center px-6 py-3 bg-green-600 border border-transparent rounded-md font-semibold text-white uppercase tracking-widest hover:bg-green-700 focus:bg-green-700 active:bg-green-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition ease-in-out duration-150",children:[e.jsx(Z,{className:"mr-2 h-5 w-5"})," Start Quiz"]}),!m&&e.jsx("p",{className:"text-gray-500",children:"Waiting for the host to start the quiz..."})]}),s.status==="active"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-md text-gray-600 mb-2",children:["Difficulty Level: ",e.jsx("span",{className:`font-semibold ${r.difficulty==="easy"?"text-green-600":r.difficulty==="average"?"text-yellow-600":"text-red-600"}`,children:r.difficulty.charAt(0).toUpperCase()+r.difficulty.slice(1)})]}),r.time_limit!==void 0&&e.jsx("div",{className:"mb-4",children:e.jsx(J,{timeLeft:p,totalTime:r.time_limit})}),e.jsx("p",{className:"text-xl mb-4 font-semibold",children:r.question_text}),r.image_path&&e.jsx("img",{src:`/storage/${r.image_path}`,alt:"Question Image",className:"mb-4 max-h-80 object-contain mx-auto rounded-lg shadow-md"}),r.type==="multiple-choice"&&e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-700 mb-3",children:"Choices:"}),r.options&&r.options.length>0?r.options.map(t=>e.jsxs("div",{className:`p-4 rounded-md border-2 flex items-center transition-all ${x&&t.is_correct?"bg-green-100 border-green-500 shadow-md":"bg-gray-50 border-gray-300 hover:bg-gray-100"}`,children:[e.jsx("span",{className:`text-lg font-medium ${x&&t.is_correct?"text-green-800":"text-gray-800"}`,children:t.option_text}),x&&t.is_correct&&e.jsx(F,{className:"ml-auto h-5 w-5 text-green-600"})]},t.id)):e.jsx("p",{className:"text-gray-500 italic",children:"No options available for this question."})]}),r.type==="true-false"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`p-3 rounded-md border ${x&&r.true_false_answer===!0?"bg-green-100 border-green-500":"bg-gray-50 border-gray-200"}`,children:e.jsx("span",{className:"text-lg font-medium text-gray-800",children:"True"})}),e.jsx("div",{className:`p-3 rounded-md border ${x&&r.true_false_answer===!1?"bg-green-100 border-green-500":"bg-gray-50 border-gray-200"}`,children:e.jsx("span",{className:"text-lg font-medium text-gray-800",children:"False"})})]}),r.type==="short-answer"&&e.jsx("div",{className:`mt-4 p-3 rounded-md border ${x?"bg-green-100 border-green-500":"bg-gray-50 border-gray-200"}`,children:e.jsxs("span",{className:"text-lg font-medium text-gray-800",children:["Hint: Not all possible answers for short answer will be shown, but this is the set answer:",e.jsx("br",{}),x&&e.jsx("span",{className:"font-bold",children:r.short_answer})]})}),x&&e.jsxs("p",{className:"mt-4 text-green-700 font-bold text-lg flex items-center",children:[e.jsx(F,{className:"mr-2 h-5 w-5"})," Correct Answer: ",X(r)]}),m&&e.jsxs("div",{className:"mt-6 flex justify-between gap-4",children:[e.jsxs("button",{onClick:P,disabled:x,className:`inline-flex items-center px-6 py-3 rounded-md font-semibold text-white uppercase tracking-widest transition ease-in-out duration-150 ${x?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:bg-blue-700 active:bg-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}`,children:[e.jsx(F,{className:"mr-2 h-5 w-5"})," Reveal Answer"]}),e.jsxs("button",{onClick:E,className:"inline-flex items-center px-6 py-3 bg-indigo-600 border border-transparent rounded-md font-semibold text-white uppercase tracking-widest hover:bg-indigo-700 focus:bg-indigo-700 active:bg-indigo-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition ease-in-out duration-150",children:[e.jsx(ne,{className:"mr-2 h-5 w-5"})," Next Question"]})]})]}),Y&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-3xl font-bold text-green-700 mb-4",children:"Quiz Finished!"}),e.jsx("p",{className:"text-lg text-gray-700 mb-6",children:"You can now check the final leaderboard."}),e.jsx("button",{onClick:()=>Q.visit(route("dashboard")),className:"inline-flex items-center px-6 py-3 bg-gray-600 border border-transparent rounded-md font-semibold text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition ease-in-out duration-150",children:"Back to Dashboard"})]})]}),e.jsxs("div",{className:"md:col-span-1 bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:[e.jsxs("h3",{className:"text-2xl font-bold mb-4 flex items-center",children:[e.jsx(ee,{className:"mr-2 h-6 w-6 text-yellow-500"})," Leaderboard"]}),C.length>0?e.jsx("ol",{className:"space-y-3",children:C.map((t,n)=>(H(t),e.jsx("li",{className:`flex flex-col items-start p-3 rounded-md shadow-sm border ${n===0?"bg-yellow-100 border-yellow-400":n===1?"bg-gray-100 border-gray-300":n===2?"bg-amber-100 border-amber-300":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"flex justify-between w-full items-center mb-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"font-bold text-lg mr-2 w-6 text-center",children:[n+1,"."]}),e.jsx(te,{className:"mr-2 h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-800",children:t.user_name})]}),e.jsx("span",{className:"font-bold text-xl text-indigo-600",children:t.score})]})},t.user_id)))}):e.jsx("p",{className:"text-gray-600",children:"No participants yet. Waiting for players."}),C.length>0&&m&&e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row justify-center gap-4",children:[e.jsxs("button",{onClick:U,className:"inline-flex items-center px-4 py-2 bg-gray-200 border border-gray-300 rounded-md font-semibold text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"})," Print Leaderboard"]}),e.jsxs("button",{onClick:W,className:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-white uppercase tracking-widest shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150",children:[e.jsx(se,{className:"mr-2 h-4 w-4"})," Download CSV Report"]})]})]})]})})]})}export{je as default};
