import{q as O,r as m,j as e,B as J,b as H}from"./app-DWT7hB3X.js";import{A as W}from"./AuthenticatedLayout-oP7-p8OQ.js";import{S as b}from"./sweetalert2.esm.all-ePrzfkxH.js";import{S as k}from"./sparkles-BP5N9dl-.js";import{U as K}from"./upload-DVNEqB5z.js";import{F as V}from"./file-text-dwy3FULc.js";import{L as X}from"./loader-circle-CGvFgGp7.js";import"./transition-D2D_kb1X.js";import"./render-DRiD-TBL.js";import"./createLucideIcon-Dpa32nA7.js";const P="http://localhost:8800";function xe(){const{subject_id:j}=O().props,w=j!=null&&j!==""?Number(j):null,[v,y]=m.useState(!1),[p,C]=m.useState("image"),[x,F]=m.useState(null),[R,M]=m.useState(null),Q=m.useRef(null),[z,A]=m.useState(""),[h,T]=m.useState(""),[q,_]=m.useState(""),[N,S]=m.useState({easy:{questionTypeCounts:{"multiple-choice":0,"true-false":0,"short-answer":0},randomizeCounts:!1,randomRanges:{"multiple-choice":{min:0,max:0},"true-false":{min:0,max:0},"short-answer":{min:0,max:0}}},average:{questionTypeCounts:{"multiple-choice":0,"true-false":0,"short-answer":0},randomizeCounts:!1,randomRanges:{"multiple-choice":{min:0,max:0},"true-false":{min:0,max:0},"short-answer":{min:0,max:0}}},hard:{questionTypeCounts:{"multiple-choice":0,"true-false":0,"short-answer":0},randomizeCounts:!1,randomRanges:{"multiple-choice":{min:0,max:0},"true-false":{min:0,max:0},"short-answer":{min:0,max:0}}}}),[Y,Z]=m.useState({"multiple-choice":0,"true-false":0,"short-answer":0}),[ee,te]=m.useState(!1),[se,re]=m.useState({"multiple-choice":{min:0,max:0},"true-false":{min:0,max:0},"short-answer":{min:0,max:0}}),G=(t,r,o)=>{S(s=>({...s,[t]:{...s[t],questionTypeCounts:{...s[t].questionTypeCounts,[r]:o}}}))},$=(t,r,o,s)=>{S(n=>({...n,[t]:{...n[t],randomRanges:{...n[t].randomRanges,[r]:{...n[t].randomRanges[r],[o]:s}}}}))},B=(t,r)=>{S(o=>({...o,[t]:{...o[t],randomizeCounts:r}}))},L=t=>{var o;const r=(o=t.target.files)==null?void 0:o[0];if(r)if(F(r),r.type.startsWith("image/")){const s=new FileReader;s.onloadend=()=>{M(s.result)},s.readAsDataURL(r)}else M(null)},U=t=>new Promise((r,o)=>{const s=new FileReader;s.readAsDataURL(t),s.onload=()=>r(s.result),s.onerror=n=>o(n)}),D=({min:t,max:r})=>{const o=Math.max(0,Math.floor(Number.isFinite(t)?t:0)),s=Math.max(0,Math.floor(Number.isFinite(r)?r:0)),n=Math.max(o,s);return n===0?0:Math.floor(Math.random()*(n-o+1))+o},E=async()=>{if(v)return;const t=["multiple-choice","true-false","short-answer"],r=["easy","average","hard"];let o=!1;for(const s of r){const n=N[s];if(t.some(a=>{if(!n.randomizeCounts)return n.questionTypeCounts[a]>0;const{min:i,max:d}=n.randomRanges[a];return Math.max(i,d)>0})){o=!0;break}}if(!o){b.fire({icon:"warning",title:"No Questions",text:"Please set at least one question for any difficulty level and question type."});return}y(!0);try{const s=[],n={easy:{"multiple-choice":0,"true-false":0,"short-answer":0},average:{"multiple-choice":0,"true-false":0,"short-answer":0},hard:{"multiple-choice":0,"true-false":0,"short-answer":0}};for(const c of r){const a=N[c];for(const i of t){const d=a.randomizeCounts?D(a.randomRanges[i]):a.questionTypeCounts[i];if(!d||d<=0)continue;n[c][i]=d;let g;const l={difficulty:c==="average"?"medium":c,num_questions:d,question_type:i};if(p==="image"&&x){const u=await U(x);l.file=u,l.file_name=x.name,l.file_type=x.type,h&&(l.topic=h),g=await fetch(`${P}/generate-quiz`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}else if(p==="text"){if(!z&&!h){b.fire({icon:"warning",title:"Missing Information",text:"Please provide either text content or a topic."}),y(!1);return}l.text=z,l.topic=h,g=await fetch(`${P}/generate-quiz-from-text`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}else if(p==="prompt"){if(!q.trim()){b.fire({icon:"warning",title:"Missing Prompt",text:"Please enter a custom prompt."}),y(!1);return}l.prompt=q,g=await fetch(`${P}/generate-custom-prompt-quiz`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})}else{b.fire({icon:"error",title:"Invalid Method",text:"Please select a generation method and provide the required input."}),y(!1);return}if(!g.ok){const u=await g.json().catch(()=>({}));throw new Error(u.error||`Server error: ${g.status}`)}const f=await g.json();if(f.success&&f.quiz&&f.quiz.questions){const u=f.quiz.questions.map(I=>({...I,difficulty:c}));s.push(...u)}else throw new Error(`Invalid response from AI service for ${c} ${i} questions`)}}if(s.length>0){const c=[];for(const d of r){const g=d.charAt(0).toUpperCase()+d.slice(1),l=n[d],f=t.filter(u=>l[u]>0).map(u=>`${u==="multiple-choice"?"MC":u==="true-false"?"T/F":"SA"}: ${l[u]}`);f.length>0&&c.push(`${g} (${f.join(", ")})`)}const a=c.join(" | "),i={quiz_title:h||"AI Generated Quiz",quiz_description:`Quiz generated with ${s.length} questions across multiple difficulty levels and question types`,topic:h||"General",difficulty:"mixed",questions:s,subject_id:w,question_type_config:{per_difficulty_configs:N,counts_used:n}};sessionStorage.setItem("aiGeneratedQuiz",JSON.stringify(i)),b.fire({icon:"success",title:"Quiz Generated!",text:`Successfully generated ${s.length} questions (${a}). Redirecting to create quiz...`,timer:2e3,showConfirmButton:!1,timerProgressBar:!0}).then(()=>{const d=w?`?subject_id=${w}`:"";H.visit(`/createquiz${d}`)})}else throw new Error("No questions were generated")}catch(s){console.error("Error generating quiz:",s),b.fire({icon:"error",title:"Generation Failed",text:s.message||"Failed to generate quiz. Please try again."})}finally{y(!1)}};return e.jsxs(W,{children:[e.jsx(J,{title:"AI Quiz Generator"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 text-gray-900",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 flex items-center gap-2",children:[e.jsx(k,{className:"w-6 h-6 text-purple-600"}),"AI Quiz Generator"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Generate quizzes instantly using AI from your study materials, text, or custom prompts."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Generation Method"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>C("image"),className:`p-4 border-2 rounded-lg transition-colors ${p==="image"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(K,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("h3",{className:"font-semibold",children:"From Image"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload study materials"})]}),e.jsxs("button",{onClick:()=>C("text"),className:`p-4 border-2 rounded-lg transition-colors ${p==="text"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(V,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("h3",{className:"font-semibold",children:"From Text/Topic"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Enter text or topic"})]}),e.jsxs("button",{onClick:()=>C("prompt"),className:`p-4 border-2 rounded-lg transition-colors ${p==="prompt"?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(k,{className:"w-6 h-6 mx-auto mb-2"}),e.jsx("h3",{className:"font-semibold",children:"Custom Prompt"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Describe what you want"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[p==="image"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Study Material (Image/PDF)"}),e.jsx("input",{ref:Q,type:"file",accept:"image/*,.pdf",onChange:L,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100"}),x&&e.jsx("div",{className:"mt-2",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Selected file:"})," ",x.name,e.jsxs("span",{className:"text-gray-400 ml-2",children:["(",(x.size/1024/1024).toFixed(2)," MB)"]})]})}),R&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:R,alt:"Preview",className:"max-w-md h-48 object-contain border rounded-lg"})}),x&&x.type==="application/pdf"&&e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("span",{className:"font-medium",children:"ðŸ“„ PDF file selected."})," The quiz will be generated from the content of this PDF."]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Topic (Optional)"}),e.jsx("input",{type:"text",value:h,onChange:t=>T(t.target.value),placeholder:"e.g., Biology, Mathematics, History",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"})]})]}),p==="text"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Topic"}),e.jsx("input",{type:"text",value:h,onChange:t=>T(t.target.value),placeholder:"e.g., Philippine History, Algebra, Biology",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Text Content (Optional)"}),e.jsx("textarea",{value:z,onChange:t=>A(t.target.value),placeholder:"Paste your study material text here...",rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"})]})]}),p==="prompt"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Prompt"}),e.jsx("textarea",{value:q,onChange:t=>_(t.target.value),placeholder:"e.g., Create a quiz about the Spanish colonial period in the Philippines with 15 questions focusing on key events and figures.",rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"})]})]}),e.jsx("div",{className:"mb-6 space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Configure Questions Per Difficulty Level"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Set the number of questions for each difficulty level (Easy, Average, Hard) and question type (Multiple Choice, True/False, Short Answer)."}),["easy","average","hard"].map(t=>{const r=N[t],o=t.charAt(0).toUpperCase()+t.slice(1),s=t==="easy"?"border-green-200":t==="average"?"border-yellow-200":"border-red-200",n=t==="easy"?"bg-green-50":t==="average"?"bg-yellow-50":"bg-red-50",c=t==="easy"?"text-green-700":t==="average"?"text-yellow-700":"text-red-700";return e.jsxs("div",{className:`mb-6 p-4 border-2 rounded-lg ${s} ${n}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:`text-lg font-semibold ${c}`,children:[o," Round"]}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300",checked:r.randomizeCounts,onChange:a=>B(t,a.target.checked)}),"Randomize"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{key:"multiple-choice",label:"Multiple Choice",border:"border-blue-200",bg:"bg-blue-50",text:"text-blue-700"},{key:"true-false",label:"True/False",border:"border-purple-200",bg:"bg-purple-50",text:"text-purple-700"},{key:"short-answer",label:"Short Answer",border:"border-indigo-200",bg:"bg-indigo-50",text:"text-indigo-700"}].map(a=>e.jsxs("div",{className:`border rounded-lg p-3 ${a.border} ${a.bg}`,children:[e.jsx("label",{className:`block text-xs font-semibold mb-2 ${a.text}`,children:a.label}),r.randomizeCounts?e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Min"}),e.jsx("input",{type:"number",min:"0",max:"50",value:r.randomRanges[a.key].min,onChange:i=>$(t,a.key,"min",parseInt(i.target.value)||0),className:"w-full px-2 py-1 border rounded-md focus:ring-purple-500 focus:border-purple-500 border-gray-200 text-sm",placeholder:"Min"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Max"}),e.jsx("input",{type:"number",min:"0",max:"50",value:r.randomRanges[a.key].max,onChange:i=>$(t,a.key,"max",parseInt(i.target.value)||0),className:"w-full px-2 py-1 border rounded-md focus:ring-purple-500 focus:border-purple-500 border-gray-200 text-sm",placeholder:"Max"})]})]}):e.jsx("input",{type:"number",min:"0",max:"50",value:r.questionTypeCounts[a.key],onChange:i=>G(t,a.key,parseInt(i.target.value)||0),className:"w-full px-3 py-2 border rounded-md focus:ring-purple-500 focus:border-purple-500 border-gray-200 text-sm",placeholder:"Count"})]},a.key))})]},t)})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:E,disabled:v,className:"bg-purple-600 text-white px-8 py-3 rounded-md text-lg font-semibold hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-5 h-5 animate-spin"}),"Generating Quiz..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-5 h-5"}),"Generate Quiz"]})})})]})})})})]})}export{xe as default};
