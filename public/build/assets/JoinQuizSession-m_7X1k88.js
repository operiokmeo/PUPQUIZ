import{q as Y,r as a,j as e,B as x}from"./app-DfPUS0g-.js";import{A as g}from"./AuthenticatedLayout-DP1sGqdd.js";import{S as u}from"./sweetalert2.esm.all-ePrzfkxH.js";import{C as W,A as X}from"./AnimatedTimer-B63mX66U.js";import{L as K}from"./soundEffects-CzFTkC61.js";import"./transition-CdeAVsF6.js";import"./render-TPd2KTBo.js";import"./createLucideIcon-BW7jgRi7.js";import"./clock-CAzn1UTl.js";function re({quiz:c}){var z,B,L,$,E,Q;const{auth:C}=Y().props,w=(z=C.user)==null?void 0:z.id;(B=C.user)==null||B.name;const[t,O]=a.useState(null),[R,_]=a.useState(!0),[S,y]=a.useState(null),[n,p]=a.useState(null),[m,k]=a.useState(!1),[j,P]=a.useState(0),[f,q]=a.useState(null),[o,h]=a.useState(null),b=c.id;a.useEffect(()=>{var i;const r=(i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.content;r?q(r):(console.error("CSRF token meta tag not found in DOM!"),y("CSRF token missing. Please refresh the page."))},[]),a.useEffect(()=>{const r=async()=>{if(!(!w||!f))try{const i=await fetch(`/api/live-quizzes/${b}/join-participant`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({user_id:w})});if(!i.ok&&i.status!==409){const v=await i.json().catch(()=>({message:"Failed to join session"}));throw new Error(v.message||`Failed to join session: ${i.statusText}`)}const l=await fetch(`/api/live-quizzes/${b}/session`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":f,"X-Requested-With":"XMLHttpRequest"},credentials:"include"});if(!l.ok){if(l.status===404){y("Live session not found. Please wait for the host to start the quiz."),_(!1);return}const v=await l.json().catch(()=>({message:l.statusText}));throw new Error(v.message||`Failed to fetch session: ${l.statusText}`)}const N=await l.json();O(N)}catch(i){console.error("Error fetching live session data:",i),y(`Failed to load quiz session: ${i.message||"Unknown error"}`)}finally{_(!1)}};if(f){r();const i=setInterval(r,2e3);return()=>clearInterval(i)}},[b,w,f]);const s=t?c.questions[t.current_question_index]:null;a.useEffect(()=>{t&&t.status==="active"&&s&&!t.show_answer?(p(null),k(!1),s.time_limit!==void 0?h(s.time_limit):h(null)):(t!=null&&t.show_answer||(t==null?void 0:t.status)!=="active")&&h(null)},[s,t]),a.useEffect(()=>{let r=null;return t&&t.status==="active"&&s&&s.time_limit!==void 0&&o!==null&&o>0&&!m&&!t.show_answer&&(r=setInterval(()=>{h(i=>i===null||i<=1?(clearInterval(r),u.fire({toast:!0,position:"top-end",icon:"warning",title:"Time's Up!",text:"Your answer was not submitted.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),0):i-1)},1e3)),()=>{r&&clearInterval(r)}},[t,s,o,m]);const I=async()=>{if(!(!s||!t||m||n===null)){if(o!==null&&o<=0){u.fire({toast:!0,position:"top-end",icon:"warning",title:"Time has run out!",text:"Cannot submit answer after time limit.",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});return}if(t.show_answer){u.fire({toast:!0,position:"top-end",icon:"warning",title:"Answer already revealed!",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});return}if(s.type==="short-answer"&&typeof n=="string"&&n.trim()===""){u.fire({toast:!0,position:"top-end",icon:"warning",title:"Please type an answer!",showConfirmButton:!1,timer:3e3,timerProgressBar:!0});return}try{const r=await fetch(`/api/live-quizzes/${b}/submit-answer`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f},body:JSON.stringify({question_id:s.id,answer:n})}),i=await r.json();r.ok?(k(!0),P(i.score),u.fire({icon:i.is_correct?"success":"error",title:i.is_correct?"Answer Submitted Successfully!":"Answer Submitted",html:`
                        <div class="text-left">
                            <p class="mb-2">Your answer has been submitted successfully.</p>
                            <p class="text-sm text-gray-600 mb-2">${i.is_correct?"✓ Correct Answer!":"✗ Incorrect Answer"}</p>
                            <p class="text-sm text-gray-600">Your current score: <strong>${i.score}</strong> points</p>
                        </div>
                    `,confirmButtonColor:i.is_correct?"#10b981":"#f97316",confirmButtonText:"OK",allowOutsideClick:!1})):u.fire({icon:"error",title:"Submission Failed",html:`
                        <div class="text-left">
                            <p class="mb-2">${i.message||"Failed to submit answer."}</p>
                            <p class="text-sm text-gray-600">Please try again or contact the organizer if the problem persists.</p>
                        </div>
                    `,confirmButtonColor:"#f97316",confirmButtonText:"OK",allowOutsideClick:!1})}catch(r){console.error("Error submitting answer:",r),u.fire({icon:"error",title:"Submission Error",html:`
                    <div class="text-left">
                        <p class="mb-2">An error occurred while submitting your answer.</p>
                        <p class="text-sm text-gray-600">${r.message||"Please try again or contact the organizer if the problem persists."}</p>
                    </div>
                `,confirmButtonColor:"#f97316",confirmButtonText:"OK",allowOutsideClick:!1})}}},D=r=>{var i;switch(r.type){case"multiple-choice":const l=(i=r.options)==null?void 0:i.find(N=>N.is_correct);return l?`Correct Answer: ${l.option_text}`:"No correct answer specified.";case"true-false":return`Correct Answer: ${r.true_false_answer?"True":"False"}`;case"short-answer":return`Correct Answer: ${r.short_answer||"No correct answer specified."}`;default:return"Unknown question type."}},A=m||n===null||typeof n=="string"&&n.trim()===""||o!==null&&o<=0,d=o!==null&&o<=0||(t==null?void 0:t.show_answer);if(R)return e.jsxs(g,{children:[e.jsx(x,{title:"Join Live Quiz"}),e.jsx("div",{className:"py-12 text-center",children:e.jsxs("p",{className:"text-gray-600 flex items-center justify-center",children:[e.jsx(K,{className:"animate-spin mr-2",size:24})," Loading live session..."]})})]});if(S)return e.jsxs(g,{children:[e.jsx(x,{title:"Join Live Quiz"}),e.jsxs("div",{className:"py-12 text-center text-red-600",children:[e.jsx(W,{className:"inline-block mr-2"})," ",S]})]});if(!t||!s){const r=(t==null?void 0:t.status)==="finished";return(t==null?void 0:t.status)==="waiting"?e.jsxs(g,{children:[e.jsx(x,{title:"Join Live Quiz"}),e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Waiting for the host to start the quiz."}),e.jsxs("p",{className:"text-gray-600",children:["Quiz Code: ",e.jsx("span",{className:"font-bold text-indigo-700",children:c.code})]})]})]}):r?e.jsxs(g,{children:[e.jsx(x,{title:"Join Live Quiz"}),e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("h3",{className:"text-3xl font-bold text-green-700 mb-4",children:"Quiz Finished!"}),e.jsxs("p",{className:"text-lg text-gray-700 mb-6",children:["Your final score: ",e.jsx("span",{className:"font-bold text-indigo-600",children:j})]}),e.jsx("button",{onClick:()=>window.location.href=route("dashboard"),className:"inline-flex items-center px-6 py-3 bg-gray-600 border border-transparent rounded-md font-semibold text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition ease-in-out duration-150",children:"Back to Dashboard"})]})]}):e.jsxs(g,{children:[e.jsx(x,{title:"Join Live Quiz"}),e.jsx("div",{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No active question in this live session."})})]})}const T=t.status==="finished",F=t.status==="waiting",J=t.show_answer;return e.jsxs(g,{header:e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:["Join Live Quiz: ",c.title]}),children:[e.jsx(x,{title:`Join Quiz: ${c.title}`}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-3xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:[e.jsxs("h3",{className:"text-2xl font-bold mb-4 text-center",children:["Question ",t.current_question_index+1," / ",c.questions.length]}),t.status==="active"&&s.time_limit!==void 0&&e.jsx("div",{className:"text-right mb-4",children:e.jsx(X,{timeLeft:o,totalTime:s.time_limit})}),F&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Waiting for the host to start the quiz."}),e.jsxs("p",{className:"text-gray-600",children:["Quiz Code: ",e.jsx("span",{className:"font-bold text-indigo-700",children:c.code})]})]}),T&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-3xl font-bold text-green-700 mb-4",children:"Quiz Finished!"}),e.jsxs("p",{className:"text-lg text-gray-700 mb-6",children:["Your final score: ",e.jsx("span",{className:"font-bold text-indigo-600",children:j})]}),e.jsx("button",{onClick:()=>window.location.href=route("dashboard"),className:"inline-flex items-center px-6 py-3 bg-gray-600 border border-transparent rounded-md font-semibold text-white uppercase tracking-widest hover:bg-gray-700 focus:bg-gray-700 active:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition ease-in-out duration-150",children:"Back to Dashboard"})]}),!F&&!T&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-md text-gray-600 mb-2",children:["Difficulty: ",e.jsx("span",{className:`font-semibold ${s.difficulty==="easy"?"text-green-600":s.difficulty==="average"?"text-yellow-600":"text-red-600"}`,children:s.difficulty.charAt(0).toUpperCase()+s.difficulty.slice(1)})]}),e.jsx("p",{className:"text-xl mb-4 font-semibold",children:s.question_text}),s.image_path&&e.jsx("img",{src:`/storage/${s.image_path}`,alt:"Question Image",className:"mb-4 max-h-80 object-contain mx-auto rounded-lg shadow-md"}),J?e.jsxs("div",{className:"mt-4 p-4 rounded-md text-center",children:[e.jsx("p",{className:"text-xl font-bold text-gray-800 mb-2",children:"Answer Revealed!"}),e.jsx("p",{className:"text-lg text-green-700 font-semibold",children:D(s)}),m&&e.jsxs("p",{className:`mt-2 text-md font-medium ${n&&(s.type==="multiple-choice"&&((E=($=s.options)==null?void 0:$.find(r=>r.id.toString()===n))!=null&&E.is_correct)||s.type==="true-false"&&n==="true"&&s.true_false_answer||n==="false"&&!s.true_false_answer||s.type==="short-answer"&&n.toString().toLowerCase()===((Q=s.short_answer)==null?void 0:Q.toLowerCase()))?"text-green-600":"text-red-600"}`,children:["Your Answer: ",n==null?void 0:n.toString()]}),!m&&o!==null&&o<=0&&e.jsx("p",{className:"mt-2 text-md font-medium text-red-600",children:"You did not submit an answer in time."}),e.jsxs("p",{className:"mt-4 text-xl font-bold text-indigo-600",children:["Your Score: ",j]})]}):e.jsxs("div",{className:"mt-4",children:[s.type==="multiple-choice"&&e.jsx("div",{className:"space-y-3",children:(L=s.options)==null?void 0:L.map(r=>e.jsx("button",{onClick:()=>p(r.id.toString()),disabled:d,className:"w-full p-3 rounded-md border text-left transition-all duration-200 "+(n===r.id.toString()?"bg-indigo-100 border-indigo-500 text-indigo-800 ":"bg-gray-50 border-gray-200 hover:bg-gray-100 ")+(d?"opacity-70 cursor-not-allowed":"cursor-pointer"),children:r.option_text},r.id))}),s.type==="true-false"&&e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>p("true"),disabled:d,className:"flex-1 p-3 rounded-md border text-center transition-all duration-200 "+(n==="true"?"bg-indigo-100 border-indigo-500 text-indigo-800 ":"bg-gray-50 border-gray-200 hover:bg-gray-100 ")+(d?"opacity-70 cursor-not-allowed":"cursor-pointer"),children:"True"}),e.jsx("button",{onClick:()=>p("false"),disabled:d,className:"flex-1 p-3 rounded-md border text-center transition-all duration-200 "+(n==="false"?"bg-indigo-100 border-indigo-500 text-indigo-800 ":"bg-gray-50 border-gray-200 hover:bg-gray-100 ")+(d?"opacity-70 cursor-not-allowed":"cursor-pointer"),children:"False"})]}),s.type==="short-answer"&&e.jsxs("div",{children:[e.jsx("input",{type:"text",value:n||"",onChange:r=>p(r.target.value),disabled:d,placeholder:"Type your answer here...",className:"w-full p-3 rounded-md border border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:'* For short answers, please type your answer exactly as expected (e.g., "Paris"). Answers are case-sensitive and must match perfectly.'})]}),e.jsx("button",{onClick:I,disabled:A,className:`mt-4 w-full inline-flex items-center justify-center px-6 py-3 rounded-md font-semibold text-white uppercase tracking-widest transition ease-in-out duration-150
                                                ${A?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:bg-blue-700 active:bg-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}
                                            `,children:"Submit Answer"})]})]})]})})})]})}export{re as default};
