import{q as U,r as o,j as e,b as te}from"./app-DWT7hB3X.js";import{A as re}from"./AuthenticatedLayout-oP7-p8OQ.js";import{D as ae}from"./download-DDU8GDQf.js";import{L as le}from"./layout-dashboard-C4hQctlr.js";import{C as S}from"./clock-DY8zjvnn.js";import{c as $}from"./createLucideIcon-Dpa32nA7.js";import{U as M}from"./users-znNztZlG.js";import{T as z}from"./trophy-DmGOgV5f.js";import{F as L}from"./file-text-dwy3FULc.js";import{S as E}from"./search-C5itFlP0.js";import{F as ne}from"./funnel-BpF6GJjj.js";import{U as R}from"./user-CL-HRr1h.js";import{C as F}from"./calendar-CpNrygxQ.js";import{C as ie}from"./chevron-up-CIyK11ef.js";import{C as oe}from"./chevron-down-D1qQbRbz.js";import"./transition-D2D_kb1X.js";import"./render-DRiD-TBL.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],O=$("clipboard-list",ce);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],I=$("user-check",de),De=xe=>{const{allLogs:n,lobbies:b}=U().props,{auth:me}=U().props,[d,q]=o.useState(""),[y,H]=o.useState("all"),[f,Q]=o.useState("all"),[C,j]=o.useState(new Set),[h,P]=o.useState(""),[u,B]=o.useState(""),G=o.useMemo(()=>{const s=new Set;return n==null||n.forEach(t=>{t.user_name&&s.add(t.user_name)}),Array.from(s)},[n]),V=o.useMemo(()=>{const s=new Set;return n==null||n.forEach(t=>{t.type&&s.add(t.type)}),Array.from(s)},[n]),N=o.useMemo(()=>{const s={},t=[];return n==null||n.forEach(r=>{if(r.lobby_id){if(!s[r.lobby_id]){const a=b==null?void 0:b.find(c=>c.id===r.lobby_id);s[r.lobby_id]={lobby:a||{id:r.lobby_id,name:r.lobby_name||"Unknown Lobby"},logs:[]}}s[r.lobby_id].logs.push(r)}else t.push(r)}),t.length>0&&(s[0]={lobby:{id:0,name:"General Logs"},logs:t}),s},[n,b]),p=o.useMemo(()=>{const s={};return Object.keys(N).forEach(t=>{const r=parseInt(t),{lobby:a,logs:c}=N[r];let m=c.filter(i=>{var T,k,A,D;const l=!d||((T=i.user_name)==null?void 0:T.toLowerCase().includes(d.toLowerCase()))||((k=i.description)==null?void 0:k.toLowerCase().includes(d.toLowerCase()))||((A=i.action)==null?void 0:A.toLowerCase().includes(d.toLowerCase()))||((D=i.ip_address)==null?void 0:D.includes(d)),w=y==="all"||i.type===y,se=f==="all"||i.user_name===f;let v=!0;if(h||u){const _=new Date(i.timestamp);if(h){const g=new Date(h);g.setHours(0,0,0,0),_<g&&(v=!1)}if(u){const g=new Date(u);g.setHours(23,59,59,999),_>g&&(v=!1)}}return l&&w&&se&&v});m.length>0&&(s[r]={lobby:a,logs:m})}),s},[N,d,y,f,h,u]),x=o.useMemo(()=>{const s=Object.values(p).flatMap(t=>t.logs);return{sessions:s.filter(t=>t.type==="Session History").length,quizzes:s.filter(t=>t.type==="Quiz Management").length,participants:s.filter(t=>t.type==="Lobby Management").length,leaderboard:s.filter(t=>t.type==="Scoring / Results").length,registration:s.filter(t=>t.type==="Pre-Registration Logs").length,quizSession:s.filter(t=>t.type==="Question Statistics").length,total:s.length}},[p]),J=s=>{const t=new Set(C);t.has(s)?t.delete(s):t.add(s),j(t)},K=()=>{const s=Object.keys(p).map(t=>parseInt(t));j(new Set(s))},W=()=>{j(new Set)},X=s=>new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),Y=s=>{const t=(s==null?void 0:s.toLowerCase())||"";return t.includes("create")||t.includes("login")||t==="approved"?"bg-blue-100 text-blue-800":t.includes("edit")||t.includes("update")?"bg-yellow-100 text-yellow-800":t.includes("delete")||t.includes("logout")||t==="rejected"?"bg-red-100 text-red-800":t.includes("active")?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"},Z=s=>{switch(s){case"Session History":return S;case"Lobby Management":return M;case"Quiz Management":return O;case"Scoring / Results":return z;case"Question Statistics":return L;case"Pre-Registration Logs":return I;default:return L}},ee=()=>{const s=Object.values(p).flatMap(l=>l.logs),t=["Type","User","Action","Description","IP Address","Timestamp","Lobby"],r=s.map(l=>[l.type||"",l.user_name||"",l.action||"",l.description||"",l.ip_address||"",l.timestamp||"",l.lobby_name||"General"]),a=[t.join(","),...r.map(l=>l.map(w=>`"${w}"`).join(","))].join(`
`),c=new Blob([a],{type:"text/csv"}),m=window.URL.createObjectURL(c),i=document.createElement("a");i.href=m,i.download=`audit-trails-${new Date().toISOString().split("T")[0]}.csv`,i.click(),window.URL.revokeObjectURL(m)};return e.jsx(re,{children:e.jsx("div",{className:"min-h-screen bg-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2 bg-gradient-to-r from-red-600 to-amber-600 bg-clip-text text-transparent",children:"Audit Trails & Reports"}),e.jsx("p",{className:"text-gray-600",children:"System logs and reports for monitoring activities"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:ee,className:"bg-green-500 text-white p-4 flex gap-x-3 rounded-md hover:bg-green-700 hover:cursor-pointer transition-colors",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("p",{children:"Export CSV"})]}),e.jsxs("div",{onClick:()=>te.get("/organizerLobby"),className:"bg-red-500 text-white p-4 flex gap-x-3 rounded-md hover:bg-red-700 hover:cursor-pointer transition-colors",children:[e.jsx(le,{}),e.jsx("p",{children:"Go to Dashboard"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-blue-500 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Sessions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.sessions})]}),e.jsx(S,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-purple-500 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Quizzes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.quizzes})]}),e.jsx(O,{className:"w-8 h-8 text-purple-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-green-500 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Participants"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.participants})]}),e.jsx(M,{className:"w-8 h-8 text-green-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-amber-500 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Leaderboard"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.leaderboard})]}),e.jsx(z,{className:"w-8 h-8 text-amber-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-pink-500 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Registration"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.registration})]}),e.jsx(I,{className:"w-8 h-8 text-pink-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border-l-4 border-red-500 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Quiz Session"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:x.quizSession})]}),e.jsx(L,{className:"w-8 h-8 text-red-500"})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search activities...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",value:d,onChange:s=>q(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-gray-500"}),e.jsxs("select",{className:"w-full border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white",value:y,onChange:s=>H(s.target.value),children:[e.jsx("option",{value:"all",children:"All Types"}),V.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-gray-500"}),e.jsxs("select",{className:"w-full border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white",value:f,onChange:s=>Q(s.target.value),children:[e.jsx("option",{value:"all",children:"All Users"}),G.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-gray-500"}),e.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-red-500 focus:border-red-500",value:h,onChange:s=>P(s.target.value),placeholder:"From"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-gray-500"}),e.jsx("input",{type:"date",className:"w-full border border-gray-200 rounded-lg px-4 py-3 focus:ring-2 focus:ring-red-500 focus:border-red-500",value:u,onChange:s=>B(s.target.value),placeholder:"To"})]})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:K,className:"px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Expand All"}),e.jsx("button",{onClick:W,className:"px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Collapse All"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",x.total," logs"]})]})]}),e.jsx("div",{className:"space-y-4",children:Object.keys(p).length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-12 text-center",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No logs found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search criteria or filters."})]}):Object.values(p).sort((s,t)=>s.lobby.id===0?-1:t.lobby.id===0?1:s.lobby.name.localeCompare(t.lobby.name)).map(({lobby:s,logs:t})=>{const r=C.has(s.id);return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>J(s.id),className:"w-full px-6 py-4 bg-gradient-to-r from-orange-500 to-amber-500 text-white flex items-center justify-between hover:from-orange-600 hover:to-amber-600 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[r?e.jsx(ie,{className:"w-5 h-5"}):e.jsx(oe,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-semibold",children:s.name}),e.jsxs("span",{className:"px-3 py-1 bg-white/20 rounded-full text-sm",children:[t.length," logs"]})]})}),r&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Action"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"IP Address"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase",children:"Timestamp"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:t.sort((a,c)=>new Date(c.timestamp).getTime()-new Date(a.timestamp).getTime()).map((a,c)=>{const m=Z(a.type);return e.jsxs("tr",{className:`hover:bg-red-50 transition-colors ${c%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(m,{className:"w-4 h-4 text-blue-600"})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.type})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:a.user_name||"N/A"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${Y(a.action)}`,children:a.action||"N/A"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-gray-700",children:a.description||"N/A"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm text-gray-600 font-mono",children:a.ip_address||"N/A"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:X(a.timestamp)})]})})]},`${a.id}-${c}`)})})]})})]},s.id)})})]})})})};export{De as default};
